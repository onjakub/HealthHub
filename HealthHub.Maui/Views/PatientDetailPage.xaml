<?xml version="1.0" encoding="UTF-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:HealthHub.Maui.ViewModels"
             x:DataType="viewmodels:PatientDetailViewModel"
             x:Class="HealthHub.Maui.Views.PatientDetailPage"
             Title="Patient Details">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Loading Indicator -->
            <ActivityIndicator IsVisible="{Binding IsLoading}"
                             IsRunning="{Binding IsLoading}"
                             Color="{DynamicResource Primary}"
                             HorizontalOptions="Center"
                             VerticalOptions="Center"/>

            <!-- Patient Information -->
            <Frame BackgroundColor="White"
                   CornerRadius="10"
                   Padding="15">
                <VerticalStackLayout Spacing="15">

                    <!-- Header -->
                    <HorizontalStackLayout HorizontalOptions="FillAndExpand">
                        <Label Text="{Binding Patient.FullName}"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalOptions="StartAndExpand"/>
                        <Label Text="{Binding Patient.Age}"
                               FontSize="18"
                               TextColor="#666"
                               HorizontalOptions="End"/>
                        <Label Text="years"
                               FontSize="18"
                               TextColor="#666"
                               HorizontalOptions="End"/>
                    </HorizontalStackLayout>

                    <!-- Basic Information -->
                    <Frame BackgroundColor="#F5F5F5"
                           CornerRadius="5"
                           Padding="10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Basic Information"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource Primary}"/>

                            <HorizontalStackLayout>
                                <Label Text="Email:"
                                       FontSize="16"
                                       WidthRequest="100"/>
                                <Label Text="{Binding Patient.Email}"
                                       FontSize="16"/>
                            </HorizontalStackLayout>

                            <HorizontalStackLayout>
                                <Label Text="Phone:"
                                       FontSize="16"
                                       WidthRequest="100"/>
                                <Label Text="{Binding Patient.PhoneNumber}"
                                       FontSize="16"/>
                            </HorizontalStackLayout>

                            <HorizontalStackLayout>
                                <Label Text="Address:"
                                       FontSize="16"
                                       WidthRequest="100"/>
                                <Label Text="{Binding Patient.Address}"
                                       FontSize="16"/>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Medical Information -->
                    <Frame BackgroundColor="#F5F5F5"
                           CornerRadius="5"
                           Padding="10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Medical Information"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource Primary}"/>

                            <HorizontalStackLayout>
                                <Label Text="Blood Type:"
                                       FontSize="16"
                                       WidthRequest="100"/>
                                <Label Text="{Binding Patient.BloodType}"
                                       FontSize="16"/>
                            </HorizontalStackLayout>

                            <HorizontalStackLayout>
                                <Label Text="Allergies:"
                                       FontSize="16"
                                       WidthRequest="100"/>
                                <Label Text="{Binding Patient.Allergies}"
                                       FontSize="16"/>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- Diagnostic Results -->
                    <Frame BackgroundColor="#F5F5F5"
                           CornerRadius="5"
                           Padding="10">
                        <VerticalStackLayout Spacing="10">
                            <Label Text="Diagnostic Results"
                                   FontSize="18"
                                   FontAttributes="Bold"
                                   TextColor="{DynamicResource Primary}"/>

                            <CollectionView ItemsSource="{Binding DiagnosticResults}">
                                <CollectionView.EmptyView>
                                    <Label Text="No diagnostic results available"
                                           FontSize="14"
                                           HorizontalOptions="Center"
                                           Margin="0,10,0,0"/>
                                </CollectionView.EmptyView>

                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Frame BackgroundColor="White"
                                               CornerRadius="5"
                                               Padding="10"
                                               Margin="0,5,0,5">
                                            <VerticalStackLayout Spacing="5">
                                                <Label Text="{Binding Diagnosis}"
                                                       FontSize="16"
                                                       FontAttributes="Bold"/>
                                                <Label Text="{Binding Result}"
                                                       FontSize="14"/>
                                                <Label Text="{Binding Date, StringFormat='{0:d}'}"
                                                       FontSize="12"
                                                       TextColor="#666"/>
                                            </VerticalStackLayout>
                                        </Frame>
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>
                    </Frame>

                </VerticalStackLayout>
            </Frame>

            <!-- Action Buttons -->
            <HorizontalStackLayout HorizontalOptions="FillAndExpand"
                                Spacing="15">
                <Button Text="Edit Patient"
                        Command="{Binding EditPatientCommand}"
                        BackgroundColor="{DynamicResource Secondary}"
                        TextColor="White"
                        CornerRadius="10"
                        Padding="15,10"
                        HorizontalOptions="FillAndExpand"/>

                <Button Text="Back"
                        Command="{Binding BackCommand}"
                        BackgroundColor="#6C757D"
                        TextColor="White"
                        CornerRadius="10"
                        Padding="15,10"
                        HorizontalOptions="FillAndExpand"/>
            </HorizontalStackLayout>

            <!-- Error Message -->
            <Label Text="{Binding ErrorMessage}"
                   TextColor="#DC3545"
                   FontSize="14"
                   IsVisible="{Binding HasError}"
                   HorizontalOptions="Center"
                   Margin="0,20,0,0"/>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>